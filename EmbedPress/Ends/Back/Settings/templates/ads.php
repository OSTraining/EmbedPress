<div class="embedpress_calendly_settings  background__white radius-25 p40">
    <h3 class="ads-settings-title"><?php esc_html_e("Ads Preview", "embedpress"); ?></h3>


    <div class="entry-content clear" ast-blocks-layout="true" itemprop="text">
        <div class="ad-preview-sectiion">
            <div class="video-ad-prewiew-options">
                <div class="ad__adjust__wrap " style="display: block;">

                    <div class="ad__adjust" >
                        <form class="ad__adjust__controller" id="ad-preview-0">
                            <div class="ad__adjust__controller__item">
                                <span class="controller__label">Upload Video Ad</span>
                                <div class="ad__adjust__controller__inputs ad-upload-options">
                                    <input type="button" class="uploadBtn button" value="Upload" data-upload-index="0"/><br/>
                                    <input type="hidden" id="fileInput-0" name="adFileUrl"/>
                                    <p class="uploaded-file-url-0"></p>
                                    <div class="ad__upload__preview" id="yt_ad__upload__preview" style="display:none ">
                                        <div class="instant__preview">
                                            <a href="#" id="yt_preview__remove" class="preview__remove"><i class="ep-icon ep-cross"></i></a>
                                            <img class="instant__preview__img" id="yt_logo_preview" src="" alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="ad__adjust__controller__item">
                                <span class="controller__label">Ad Start After (Sec)</span>
                                <div class="ad__adjust__controller__inputs">
                                    <input type="range" max="100" data-default="10" value="10" class="opacity__range" name="adStart">
                                    <input readonly="" type="number" class="form__control range__value" data-default="10" value="10">
                                </div>
                            </div>

                            <div class="ad__adjust__controller__item">
                                <span class="controller__label">Skip Button</span>
                                <div class="ad__adjust__controller__inputs">
                                    <label class="input__switch switch__text ">
                                        <input type="checkbox" name="adSkipButton" data-default="no" data-value="no" value="yes" checked>
                                        <span></span>
                                       
                                    </label>
                                </div>
                            </div>

                            <div class="ad__adjust__controller__item">
                                <span class="controller__label">Skip Button After (Sec)</span>
                                <div class="ad__adjust__controller__inputs">
                                    <input type="range" max="100" data-default="5" value="5" class="x__range" name="adSkipButtonAfter">
                                    <input readonly="" type="number" class="form__control range__value" data-default="5" value="5">
                                </div>
                            </div>

                            <button type="submit" class="button preview-btn-0"> Play Preview </button>
                        </form>

                    </div>
                </div>
            </div>
            <div class="embedpress-gutenberg-wrapper aligncenter   ep-content-protection-disabled inline" id="1c3da3de-7606-4e9f-9693-d4b570cd2ca3">
                <h2 class="wp-block-heading has-text-align-center"><mark style="background-color:rgba(0, 0, 0, 0)" class="has-inline-color has-ast-global-color-2-color">Video ad Preview</mark> in Video</h2>
                <div class="wp-block-embed__wrapper   ">
                    <div id="ep-gutenberg-content-ep-ad-preview-0" class="ep-gutenberg-content">
                        <div data-ad-id="ep-ad-preview-0" id="ep-ad-preview-0" class="ad-mask" data-ad-index="0">
                            <div class="ep-embed-content-wraper ">
                                <iframe class="ose-youtube ose-uid-cc92f1bdd0d47ed2a129c320c1082ad5 ose-embedpress-responsive" style="width: 600px; height: 550px; max-height: 338px; max-width: 100%; display: inline-block;" frameborder="0" allowfullscreen="1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" title="How To Make Any Page Layout Using The WordPress Block Editor: Gutenberg" width="640" height="360" src="https://www.youtube.com/embed/AMU66nbFnGg?enablejsapi=1&amp;origin=http%3A%2F%2Fembedpress.local&amp;widgetid=1" id="widget2"></iframe> </div>
                            <div class="main-ad-template" id="ad-template-0" style="display:none">
                                <div class="ep-ad-container">

                                    <div class="ep-ad-content ad-video hidden" style="position: relative;">
                                        <a target="_blank" href="https://wpdeveloper.com/"> 

                                            <video class="ep-ad" muted="">
                                                <source src="http://embedpress.local/wp-content/uploads/2023/11/5-Stars-Everywhere.mp4">
                                            </video>

                                            <div class="ad-timer">
                                                <span class="ad-running-time"></span>
                                                <span class="ad-duration">&nbsp;â€¢ Ad</span>
                                            </div>
                                            <div class="progress-bar-container">
                                                <div class="progress-bar"></div>
                                            </div>


                                        </a>


                                        <button title="Skip Ad" class="skip-ad-button" style="display: none;">
                                            Skip Ad </button>

                                    </div>

                                    <div class="ep-ad-content ad-image hidden" style="position: relative;">
                                        <img decoding="async" class="ep-ad" src="http://embedpress.local/wp-content/uploads/2023/11/27946a99657cddf0cbde79a7e4e6f51f.gif">

                                        <button title="Skip Ad" class="skip-ad-button" style="display: inline-block;">
                                            Skip Ad </button>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <style>
                .ose-uid-cc92f1bdd0d47ed2a129c320c1082ad5 {
                    width: 600px !important;
                    height: 340px !important;
                    max-width: 100%;
                }

                .ose-uid-cc92f1bdd0d47ed2a129c320c1082ad5>iframe {
                    height: 340px !important;
                    max-height: 340px !important;
                    width: 100%;
                }

                .ose-uid-cc92f1bdd0d47ed2a129c320c1082ad5 .wistia_embed {
                    max-width: 100%;
                }

                .alignright .ose-wistia.ose-uid-cc92f1bdd0d47ed2a129c320c1082ad5 {
                    margin-left: auto;
                }

                .alignleft .ose-wistia.ose-uid-cc92f1bdd0d47ed2a129c320c1082ad5 {
                    margin-right: auto;
                }

                .aligncenter .ose-wistia.ose-uid-cc92f1bdd0d47ed2a129c320c1082ad5 {
                    margin: auto;
                }

                .ose-uid-cc92f1bdd0d47ed2a129c320c1082ad5 img.watermark {
                    display: none;
                }
            </style>
        </div>

        <h2 class="wp-block-heading has-text-align-center"><mark style="background-color:rgba(0, 0, 0, 0)" class="has-inline-color has-ast-global-color-2-color">Image ad Preview</mark> in Video</h2>


        <div class="embedpress-gutenberg-wrapper aligncenter   ep-content-protection-disabled inline" id="0a6178a7-c433-4cd3-a761-edb000bbf2fa">
            <div class="wp-block-embed__wrapper   ">
                <div id="ep-gutenberg-content-291c61c171ca2add49648c86f82a230f" class="ep-gutenberg-content">
                    <div data-ad-id="291c61c171ca2add49648c86f82a230f" class="ad-mask" data-ad-index="1">
                        <div class="ep-embed-content-wraper ">
                            <iframe class="ose-youtube ose-uid-a7157e874ea458e2aaa5b5dd18af9711 ose-embedpress-responsive" style="width: 600px; height: 550px; max-height: 338px; max-width: 100%; display: inline-block;" frameborder="0" allowfullscreen="1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" title="Configure The WooCommerce My Account With EA Woo Account Dashboard Widget" width="640" height="360" src="https://www.youtube.com/embed/CEUqgOS4CN0?enablejsapi=1&amp;origin=http%3A%2F%2Fembedpress.local&amp;widgetid=3" id="widget4"></iframe> </div>
                        <div class="main-ad-template image" id="ad-291c61c171ca2add49648c86f82a230f" style="display:none">
                            <div class="ep-ad-container">
                                <div class="ep-ad-content" style="position: relative;">
                                    <img decoding="async" class="ep-ad" src="http://embedpress.local/wp-content/uploads/2023/11/27946a99657cddf0cbde79a7e4e6f51f.gif">



                                    <button title="Skip Ad" class="skip-ad-button" style="display: inline-block;">
                                        Skip Ad </button>

                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
        <style>
            .ose-uid-a7157e874ea458e2aaa5b5dd18af9711 {
                width: 600px !important;
                height: 340px !important;
                max-width: 100%;
            }

            .ose-uid-a7157e874ea458e2aaa5b5dd18af9711>iframe {
                height: 340px !important;
                max-height: 340px !important;
                width: 100%;
            }

            .ose-uid-a7157e874ea458e2aaa5b5dd18af9711 .wistia_embed {
                max-width: 100%;
            }

            .alignright .ose-wistia.ose-uid-a7157e874ea458e2aaa5b5dd18af9711 {
                margin-left: auto;
            }

            .alignleft .ose-wistia.ose-uid-a7157e874ea458e2aaa5b5dd18af9711 {
                margin-right: auto;
            }

            .aligncenter .ose-wistia.ose-uid-a7157e874ea458e2aaa5b5dd18af9711 {
                margin: auto;
            }

            .ose-uid-a7157e874ea458e2aaa5b5dd18af9711 img.watermark {
                display: none;
            }
        </style>


        <h2 class="wp-block-heading has-text-align-center"><mark style="background-color:rgba(0, 0, 0, 0)" class="has-inline-color has-ast-global-color-2-color">Video ad Preview</mark> in PDF documents</h2>

        <div id="ep-gutenberg-content-fc2d9f8fc6a2e87c25ecb6bdb7561542" class="ep-gutenberg-content ep-aligncenter ep-fixed-width   ep-content-protection-disabled ">
            <div class="embedpress-inner-iframe  ep-doc-fc2d9f8fc6a2e87c25ecb6bdb7561542" style="max-width:100%" id="embedpress-pdf-1702801774415">
                <div data-ad-id="fc2d9f8fc6a2e87c25ecb6bdb7561542" class="ad-mask" data-ad-index="2">
                    <div class="ep-embed-content-wraper">
                        <div class="position-right-wraper gutenberg-pdf-wraper"><iframe title="sample" class="embedpress-embed-document-pdf embedpress-pdf-1702801774415" style="width:600px;height:600px; max-width:100%; display: inline-block" src="http://embedpress.local/wp-admin/admin-ajax.php?action=get_viewer&amp;file=http%3A%2F%2Fembedpress.local%2Fwp-content%2Fuploads%2F2023%2F10%2Fsample.pdf#key=dGhlbWVNb2RlPWRlZmF1bHQmdG9vbGJhcj10cnVlJnBvc2l0aW9uPXRvcCZwcmVzZW50YXRpb249dHJ1ZSZkb3dubG9hZD10cnVlJmNvcHlfdGV4dD10cnVlJmFkZF90ZXh0PXRydWUmZHJhdz10cnVlJmRvY19yb3RhdGlvbj10cnVlJmRvY19kZXRhaWxzPXRydWU=" frameborder="0" oncontextmenu="return false;"></iframe>
                            <p class="embedpress-el-powered">Powered By EmbedPress</p>
                        </div>
                    </div>
                    <div class="main-ad-template video" id="ad-fc2d9f8fc6a2e87c25ecb6bdb7561542" style="display:none">
                        <div class="ep-ad-container">
                            <div class="ep-ad-content" style="position: relative;">
                                <video class="ep-ad" muted="">
                                    <source src="http://embedpress.local/wp-content/uploads/2023/11/5-Stars-Everywhere.mp4">
                                </video>

                                <div class="ad-timer">
                                    <span class="ad-running-time"></span>
                                    <span class="ad-duration">&nbsp;â€¢ Ad</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar"></div>
                                </div>




                                <button title="Skip Ad" class="skip-ad-button" style="display: none;">
                                    Skip Ad </button>

                            </div>
                        </div>
                    </div>



                </div>
            </div>
        </div>



        <h2 class="wp-block-heading has-text-align-center"><mark style="background-color:rgba(0, 0, 0, 0)" class="has-inline-color has-ast-global-color-2-color">Image ad Preview</mark> in PDF documents</h2>

        <div id="ep-gutenberg-content-1081011a548224fec38c97e5471bd6c0" class="ep-gutenberg-content ep-aligncenter ep-fixed-width   ep-content-protection-disabled ">
            <div class="embedpress-inner-iframe  ep-doc-1081011a548224fec38c97e5471bd6c0" style="max-width:100%" id="embedpress-pdf-1701320841615">
                <div data-ad-id="1081011a548224fec38c97e5471bd6c0" class="ad-mask" data-ad-index="3">
                    <div class="ep-embed-content-wraper">
                        <div class="position-right-wraper gutenberg-pdf-wraper"><iframe title="sample" class="embedpress-embed-document-pdf embedpress-pdf-1701320841615" style="width:666px;height:600px; max-width:100%; display: inline-block" src="http://embedpress.local/wp-admin/admin-ajax.php?action=get_viewer&amp;file=http%3A%2F%2Fembedpress.local%2Fwp-content%2Fuploads%2F2023%2F10%2Fsample.pdf#key=dGhlbWVNb2RlPWRlZmF1bHQmdG9vbGJhcj10cnVlJnBvc2l0aW9uPXRvcCZwcmVzZW50YXRpb249dHJ1ZSZkb3dubG9hZD10cnVlJmNvcHlfdGV4dD10cnVlJmFkZF90ZXh0PXRydWUmZHJhdz10cnVlJmRvY19yb3RhdGlvbj10cnVlJmRvY19kZXRhaWxzPXRydWU=" frameborder="0" oncontextmenu="return false;"></iframe>
                            <p class="embedpress-el-powered">Powered By EmbedPress</p>
                        </div>
                    </div>
                    <div class="main-ad-template image" id="ad-1081011a548224fec38c97e5471bd6c0" style="display:none">
                        <div class="ep-ad-container">
                            <div class="ep-ad-content" style="position: relative;">
                                <img decoding="async" class="ep-ad" src="http://embedpress.local/wp-content/uploads/2023/11/27946a99657cddf0cbde79a7e4e6f51f.gif">



                                <button title="Skip Ad" class="skip-ad-button" style="display: inline-block;">
                                    Skip Ad </button>

                            </div>
                        </div>
                    </div>



                </div>
            </div>
        </div>

    </div>

</div>

<style>
    /* page css */
    .ad-preview-sectiion {
        display: flex;
        gap: 30px;
        justify-content: space-between;
        margin-bottom: 60px;
    }

    .video-ad-prewiew-options {
        width: 49%;
    }

    .ad-upload-options{
        width: 320px;
    }

    .uploaded-file-url-0.uploaded {
        background: #efeef5;
        padding: 5px;
        word-wrap: break-word;
        border-radius: 5px;
    }
    input.uploadBtn.button {
        margin-bottom: 10px;
    }

    .ad__adjust__controller__item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 30px;
    }
    .ad__adjust__controller__inputs {
        width: 320px;
    }
    /* Common Styles */
    .ad-mask .ose-embedpress-responsive {
        position: relative;
    }

    .ad-running {
        display: inline-block !important;
    }

    .ad-mask .ep-embed-content-wraper::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
    }

    .ep-embed-content-wraper {
        position: relative;
    }

    .ose-youtube {
        /* display: none !important; */
    }

    [data-ad-id] {
        position: relative;
        display: inline-block;
    }

    .main-ad-template.image.ad-running {
        position: absolute;
        z-index: 1;
        bottom: 75px;
        left: 50%;
        height: auto;
    }

    [data-ad-id] .main-ad-template.image.ad-running {
        border-radius: 5px;
    }

    .ep-ad-container {
        position: relative;
    }

    .main-ad-template video,
    .main-ad-template img {
        width: 100%;
        height: 100%;
        background-color: #000;
    }

    .progress-bar-container {
        margin-top: -10px;
        background: #ff000021;
    }

    .progress-bar {
        background: #5be82a;
        height: 5px;
        margin-top: -4px;
        max-width: 100%;
    }

    button.skip-ad-button {
        position: absolute;
        bottom: 15px;
        right: 10px;
        border: none;
        background: #d41556b5 !important;
        color: white !important;
        z-index: 122222222;
        font-size: 14px;
        border-radius: 4px;
        height: 30px;
        width: 80px;
        font-weight: normal;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    .ad-timer {
        position: absolute;
        background: #d41556b5;
        font-size: 14px;
        width: 110px;
        color: white;
        bottom: 15px;
        left: 10px;
        text-align: center;
        border-radius: 4px;
        height: 30px;
        width: 80px;
        font-weight: normal;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    [data-ad-id] .hidden {
        display: none !important;
    }

    /* Specific Styles for Ad Type 1 */
    [data-ad-id="ep-ad-preview-0"] .main-ad-template {
        width: 600px;
        height: 340px;
        max-width: 100%;
        display: inline-block;
    }

    [data-ad-id="ep-ad-preview-0"] .main-ad-template.image.ad-running {
        width: 300px !important;
        height: 200px !important;
        bottom: 10%;
        left: 25%;
    }

    /* Specific Styles for Ad Type 2 */
    [data-ad-id="291c61c171ca2add49648c86f82a230f"] .main-ad-template {
        width: 600px;
        height: 340px;
        max-width: 100%;
        display: inline-block;
    }

    [data-ad-id="291c61c171ca2add49648c86f82a230f"] .main-ad-template.image.ad-running {
        width: 300px !important;
        height: 200px !important;
        bottom: 10%;
        left: 25%;
    }

    /* Specific Styles for Ad Type 3 */
    [data-ad-id="fc2d9f8fc6a2e87c25ecb6bdb7561542"] .main-ad-template {
        width: 600px;
        height: 550px;
        max-width: 100%;
        display: inline-block;
    }

    [data-ad-id="fc2d9f8fc6a2e87c25ecb6bdb7561542"] .main-ad-template.image.ad-running {
        width: 300px !important;
        height: 200px !important;
        bottom: 20%;
        left: 25%;
    }

    /* Specific Styles for Ad Type 4 */
    [data-ad-id="1081011a548224fec38c97e5471bd6c0"] .main-ad-template {
        width: 666px;
        height: 550px;
        max-width: 100%;
        display: inline-block;
    }

    [data-ad-id="1081011a548224fec38c97e5471bd6c0"] .main-ad-template.image.ad-running {
        width: 300px !important;
        height: 200px !important;
        bottom: 20%;
        left: 39%;
    }
</style>



<script>
const isPyr = document.querySelector('[data-playerid]')?.getAttribute('data-playerid');
if (!isPyr) {
    var scriptUrl = 'https:\/\/www.youtube.com\/s\/player\/9d15588c\/www-widgetapi.vflset\/www-widgetapi.js'; try { var ttPolicy = window.trustedTypes.createPolicy("youtube-widget-api", { createScriptURL: function (x) { return x } }); scriptUrl = ttPolicy.createScriptURL(scriptUrl) } catch (e) { } var YT; if (!window["YT"]) YT = { loading: 0, loaded: 0 }; var YTConfig; if (!window["YTConfig"]) YTConfig = { "host": "https://www.youtube.com" };
    if (!YT.loading) {
        YT.loading = 1; (function () {
            var l = []; YT.ready = function (f) { if (YT.loaded) f(); else l.push(f) }; window.onYTReady = function () { YT.loaded = 1; var i = 0; for (; i < l.length; i++)try { l[i]() } catch (e) { } }; YT.setConfig = function (c) { var k; for (k in c) if (c.hasOwnProperty(k)) YTConfig[k] = c[k] }; var a = document.createElement("script"); a.type = "text/javascript"; a.id = "www-widgetapi-script"; a.src = scriptUrl; a.async = true; var c = document.currentScript; if (c) {
                var n = c.nonce || c.getAttribute("nonce"); if (n) a.setAttribute("nonce",
                    n)
            } var b = document.getElementsByTagName("script")[0]; b.parentNode.insertBefore(a, b)
        })()
    };
}


let adsConainers = document.querySelectorAll('[data-ad-id]');
let container = document.querySelector('[data-ad-id]');
var player = [];
var playerInit = [];
var playerIndex = 0;
let adTimeOut;


adsConainers = Array.from(adsConainers);

const getYTVideoId = (url) => {
    // Check if the input is a string
    if (typeof url !== 'string') {
        return false;
    }

    const regex = /(?:youtube\.com\/(?:[^\/]+\/[^\/]+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
    const match = url.match(regex);

    if (match && match[1]) {
        return match[1];
    }
    return false;
}

const hashParentClass = (element, className) => {
    var parent = element.parentNode;

    while (parent && !parent.classList?.contains(className)) {
        parent = parent.parentNode;
    }

    return !!parent;
}



const adInitialization = (adContainer, index, adAtts, adType) => {

    const blockId = adAtts.clientId;
    const blockIdMD5 = adContainer.getAttribute('data-ad-id');
    const adStartAfter = adAtts.adStart * 1000;
    const adContent = adAtts.adContent;
    const adVideo = adContainer.querySelector('.ep-ad');
    const adSource = adAtts.adSource;
    const adVideos = [];
    const srcUrl = adAtts.url || adAtts.embedpress_embeded_link;
    const adSkipButtonAfter = parseInt(adAtts.adSkipButtonAfter);
    const adSkipButton = adAtts.adSkipButton;


    addWrapperForYoutube(adContainer, srcUrl, adAtts);

    // let adVideo = adContainer.querySelector('#ad-' + blockId + ' .ep-ad');
    adVideos.push(adVideo);

    const adTemplate = adContainer.querySelector('.main-ad-template');
    const progressBar = adContainer.querySelector('.progress-bar');
    const skipButton = adTemplate.querySelector('.skip-ad-button');
    const adRunningTime = adContainer.querySelector('.ad-running-time');
    var playerId;
    const adMask = adContainer;


    let playbackInitiated = false;
    
    if (skipButton && adSource !== 'video') {
        skipButton.style.display = 'inline-block';
    }

    const hashClass = hashParentClass(adContainer, 'ep-content-protection-enabled');

    if (hashClass) {
        adContainer.classList.remove('ad-mask');
    }

    playerId = adContainer.querySelector('[data-playerid]')?.getAttribute('data-playerid');

    if (playerInit?.length > 0) {
        playerInit[playerId]?.play();
    }


    if (getYTVideoId(srcUrl)) {
        // console.log(player[index]?.seekTo().getCurrentTime());
        player[index]?.seekTo(0);
    }
    clearTimeout(adTimeOut);

    adTemplate.classList.remove('image', 'video');
    adTemplate.classList.add(adType);

    if (!playbackInitiated) {
        adTimeOut = setTimeout(() => {
            if (adSource !== 'image') {
                adContainer.querySelector('.ep-embed-content-wraper').classList.add('hidden');
            }
            adTemplate?.classList.add('ad-running');

            adTemplate?.classList.remove('hidden');
            if (adVideo && adSource === 'video') {
                adVideo.muted = false;
                adTemplate.querySelector('.ad-video').classList.remove('hidden');
                adTemplate.querySelector('.ad-image').classList.add('hidden');
                adVideo.play();
            }

            if(adType === 'image'){
                adTemplate.querySelector('.ad-image').classList.remove('hidden');
                adTemplate.querySelector('.ad-video').classList.add('hidden');
            }
        }, adStartAfter);

        playbackInitiated = true;
    }

    adContainer.classList.remove('ad-mask');
    
    if(adType == 'video'){
        adVideo?.addEventListener('timeupdate', () => {
            const currentTime = adVideo?.currentTime;
            const videoDuration = adVideo?.duration;


            if (currentTime <= videoDuration) {
                const remainingTime = Math.max(0, videoDuration - currentTime); // Ensure it's not negative
                adRunningTime.innerText = Math.floor(remainingTime / 60) + ':' + (Math.floor(remainingTime) % 60).toString().padStart(2, '0');
            }

            if (!isNaN(currentTime) && !isNaN(videoDuration)) {
                const progress = (currentTime / videoDuration) * 100;
                progressBar.style.width = progress + '%';

                if (adSkipButton && currentTime >= adSkipButtonAfter) {
                    // Show the skip button after 3 seconds
                    skipButton.style.display = 'inline-block';
                }
            }
        });
    }
    // Add a click event listener to the skip button
    document?.addEventListener('click', (event) => {
        if (event.target.classList.contains('skip-ad-button')) {

            if(adType == 'video'){
                adVideo.pause();
                adVideo.currentTime = 0;

                if (getYTVideoId(srcUrl)) {
                    player[index]?.playVideo();
                }
                adTemplate.querySelector('.ad-video').classList.add('hidden');

            }
            else{
                adTemplate.querySelector('.ad-image').classList.add('hidden');
            }
            adContainer.querySelector('.ep-embed-content-wraper').classList.remove('hidden');
        }
    });

    if(adType == 'video'){
        // Add an event listener to check for video end
        adVideo?.addEventListener('play', () => {
            if (playerInit?.length > 0) {
                playerInit[playerId]?.stop();
            }
        });

        // Add an event listener to check for video end
        adVideo?.addEventListener('ended', () => {
            // Remove the main ad template from the DOM when the video ends
            adTemplate.classList.add('hidden');
            adContainer.querySelector('.ep-embed-content-wraper').classList.remove('hidden');
        });
    }
    playerIndex++;

}

const addWrapperForYoutube = (adContainer, srcUrl, adAtts) => {
    const youtubeIframe = adContainer.querySelector(`.ose-youtube iframe`);
    if (youtubeIframe && getYTVideoId(srcUrl)) {

        const divWrapper = document.createElement('div');
        divWrapper.className = 'ad-youtube-video';
        youtubeIframe.setAttribute('width', adAtts.width);
        youtubeIframe.setAttribute('height', adAtts.height);
        youtubeIframe.parentNode.replaceChild(divWrapper, youtubeIframe);
        divWrapper.appendChild(youtubeIframe);
    }
}



function onYouTubeIframeAPIReady(iframe, srcUrl, adVideo, index) {
    // Find the iframe by its src attribute

    if (iframe && getYTVideoId(srcUrl) !== null) {
        player[index] = new YT.Player(iframe, {
            videoId: getYTVideoId(srcUrl),

            events: {
                'onReady': (event) => onPlayerReady(event, adVideo),
            }
        });

    }

}

// This function is called when the player is ready
function onPlayerReady(event, adVideo) {
    adVideo?.addEventListener('ended', function () {
        event.target.playVideo();
    });

    adVideo?.addEventListener('play', function () {
        event.target.pauseVideo();
    });
}


window.onload = function () {
    let yVideos = setInterval(() => {
        var youtubeVideos = document.querySelectorAll('.ose-youtube');
        if (youtubeVideos.length > 0) {
            clearInterval(yVideos);

            youtubeVideos.forEach((yVideo, index) => {
                const srcUrl = yVideo.querySelector('iframe')?.getAttribute('src');
                const adVideo = yVideo.closest('.ad-mask')?.querySelector('.ep-ad');
                const isYTChannel = yVideo.closest('.ad-mask')?.querySelector('.ep-youtube-channel');
                if(adVideo && !isYTChannel){
                    onYouTubeIframeAPIReady(yVideo, srcUrl, adVideo, index);
                }
            });
        }
    }, 100);
};



function getFormData(index) {


    var form = document.getElementById("ad-preview-" + index);
    var formData = new FormData(form);

    // To get all form data as an object, you can convert FormData to JSON
    var formDataObject = {};
    formData.forEach(function(value, key){
        formDataObject[key] = value;
    }); 
    
    return formDataObject;

}

const rangeUpdate = () => {
    var rangeInputs = document.querySelectorAll('input[type="range"]');
    var numberInputs = document.querySelectorAll('input[type="number"]');

    rangeInputs.forEach(function(rangeInput, index) {
        var numberInput = numberInputs[index];

        rangeInput.addEventListener('input', function() {
            numberInput.value = rangeInput.value;
        });
    });
}

rangeUpdate();

const getAdTye = (adUrl) => {

    return mediaType; //video/image
}

jQuery(document).on('click', '.preview-btn-0', function(e){
    e.preventDefault();
    const index = 0;
    const adContainer = document.querySelector('#ep-ad-preview-'+index);
    const adType = document.querySelector('#ad-template-'+index).getAttribute('data-adType');
    const currentAdAtts = getFormData(0);
    

    const adAtts = {
        "clientId": "1c3da3de-7606-4e9f-9693-d4b570cd2ca3",
        "url": "https://www.youtube.com/watch?v=AMU66nbFnGg&pp=ygUMd3BkZXZlbG9lcGVy",
        "height": "340",
        "adManager": true,
        "adFileUrl": currentAdAtts?.adFileUrl,
        "adUrl": "https://wpdeveloper.com/",
        "width": "600",
        "adSource": adType,
        "adWidth": "300",
        "adHeight": "200",
        "adXPosition": 25,
        "adYPosition": 10,
        "adStart": currentAdAtts?.adStart,
        "adSkipButton": currentAdAtts?.adSkipButton === 'yes' ? true : false,
        "adSkipButtonAfter": currentAdAtts?.adSkipButtonAfter
    }

    if(currentAdAtts?.adFileUrl){
        adInitialization(adContainer, 0, adAtts, adType);
    }
    else{
        jQuery('.uploaded-file-url-'+index).text('Please upload a video/image Ad.' );
    }
})

jQuery(document).on('click', '.preview-btn-2', function(e){
    getFormData();
})

jQuery(document).on('click', '.preview-btn-3', function(e){
    getFormData();
})

jQuery(document).on('click', '.preview-btn-4', function(e){
    getFormData();
})





</script>

<script>
jQuery(document).ready(function($){
    var mediaUploader;

    // Trigger when the "Upload" button is clicked
    $('.uploadBtn').click(function(e) {
        e.preventDefault();

        const index = $(this).data('upload-index');

        if (mediaUploader) {
            mediaUploader.open();
            return;
        }

        // Extend the wp.media object
        mediaUploader = wp.media.frames.file_frame = wp.media({
            title: 'Choose File',
            button: {
                text: 'Choose File'
            },
            multiple: false
        });

        // Handle the file selection
        mediaUploader.on('select', function() {
            var attachment = mediaUploader.state().get('selection').first().toJSON();

            console.log(attachment);
            $('#fileInput-'+index).val(attachment.url);
            $('.uploaded-file-url-'+index).text('File Name: ' +attachment.name);
            $('#ad-template-'+index+' video').attr('src', attachment.url);
            $('#ad-template-'+index).attr('data-adType', attachment.type);
            $('.uploaded-file-url-'+index).addClass('uploaded');
        });

        // Open the media uploader
        mediaUploader.open();
    });
});

</script>
